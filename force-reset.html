<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Reset - SECO Ticket System</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #0054A6; }
        button {
            background: #0054A6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #003d7a; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
            display: none;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        #status { margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Force Reset Tool</h1>
        <p>This tool will manually reinitialize your queue configuration.</p>

        <div id="status"></div>
        <div class="success" id="successMsg">‚úÖ Reset complete! Ready to use.</div>

        <button class="danger" onclick="forceReset()">üîÑ Force Reset Everything</button>
        <button onclick="window.location.href='home.html'">Go to Home</button>
        <button onclick="window.location.href='diagnostic.html'">Run Diagnostic</button>

        <h3>What this does:</h3>
        <ul>
            <li>Manually sets queue configuration with all default queues</li>
            <li>Preserves your authentication</li>
            <li>Resets dark mode preference</li>
            <li>Clears any corrupted data</li>
        </ul>
    </div>

    <script>
        function forceReset() {
            const authToken = localStorage.getItem('authToken');
            const currentUser = localStorage.getItem('currentUser');
            const currentUserRole = localStorage.getItem('currentUserRole');
            const currentUsername = localStorage.getItem('currentUsername');
            const currentUserId = localStorage.getItem('currentUserId');

            // Define the default queue configuration directly
            const DEFAULT_QUEUE_CONFIG = [
                {
                    id: "buildings-grounds",
                    name: "Buildings & Grounds",
                    description: "Facilities and maintenance requests",
                    color: "#28a745",
                    icon: "üè¢",
                    active: true,
                    parentQueue: null,
                    order: 1,
                    categories: {
                        "HVAC": ["Heating", "Cooling", "Ventilation", "Air Quality"],
                        "Plumbing": ["Leak", "Clog/Drain", "Fixture", "Restroom"],
                        "Carpentry": ["Doors/Frames", "Furniture", "Drywall", "Ceiling"],
                        "Grounds": ["Landscaping", "Debris/Trash", "Pest Control", "Irrigation"],
                        "Custodial": ["Spill/Cleanup", "Restocking", "Floor Care", "Disinfection"],
                        "Access/Keys": ["Locks/Keys", "Badges", "Door Hardware"]
                    },
                    customFields: []
                },
                {
                    id: "electrical",
                    name: "Electrical Services",
                    description: "Electrical systems and power",
                    color: "#ffc107",
                    icon: "‚ö°",
                    active: true,
                    parentQueue: null,
                    order: 2,
                    categories: {
                        "Power": ["Outage", "Brownout", "Circuit/Breaker", "Panel"],
                        "Lighting": ["Interior Lighting", "Exterior Lighting", "Emergency Lighting", "Bulb/Ballast"],
                        "Equipment": ["Generator", "UPS", "Surge/Power Quality", "Equipment Hookup"],
                        "Safety": ["Egress/Exit Signs", "GFCI/AFCI", "Arc Flash", "Inspection"],
                        "Meters/Monitoring": ["Meter Issue", "Monitoring/SCADA", "Load Study"]
                    },
                    customFields: []
                },
                {
                    id: "moves",
                    name: "Move Requests",
                    description: "Office and equipment moves",
                    color: "#6f42c1",
                    icon: "üì¶",
                    active: true,
                    parentQueue: null,
                    order: 3,
                    categories: {
                        "Office Move": ["Furniture/Desk", "IT Equipment", "Full Office", "Cubicle/Workstation"],
                        "IT Relocation": ["Desktop/Laptop", "Phone", "Network Equipment", "User Permissions"],
                        "Facilities Move": ["Furniture Only", "Equipment Only", "Storage/Archive"],
                        "User Setup": ["Role Change", "Department Transfer", "Permissions Update"]
                    },
                    customFields: []
                },
                {
                    id: "rma",
                    name: "RMA / Warehouse",
                    description: "Returns, exchanges, and inventory",
                    color: "#17a2b8",
                    icon: "üîÑ",
                    active: true,
                    parentQueue: null,
                    order: 4,
                    categories: {
                        "RMA": ["Return", "Exchange", "Warranty", "Defective"],
                        "Parts Request": ["Stock Item", "Special Order", "Emergency", "Scheduled"],
                        "Inventory": ["Stock Check", "Reorder", "Count/Audit", "Location"],
                        "Shipping": ["Outbound", "Inbound", "Tracking", "Lost/Damaged"]
                    },
                    customFields: []
                },
                {
                    id: "it",
                    name: "Information Technology",
                    description: "IT support and services",
                    color: "#0078ff",
                    icon: "üíª",
                    active: true,
                    parentQueue: null,
                    order: 5,
                    categories: {
                        "Hardware": ["Desktop", "Laptop", "Printer", "Monitor"],
                        "Software": ["Application", "License", "Update", "Installation"],
                        "Network": ["Internet", "WiFi", "VPN", "Connectivity"],
                        "Account": ["Password", "Access", "Permissions", "Email"]
                    },
                    customFields: []
                }
            ];

            // Clear everything
            localStorage.clear();

            // Restore authentication
            if (authToken) localStorage.setItem('authToken', authToken);
            if (currentUser) localStorage.setItem('currentUser', currentUser);
            if (currentUserRole) localStorage.setItem('currentUserRole', currentUserRole);
            if (currentUsername) localStorage.setItem('currentUsername', currentUsername);
            if (currentUserId) localStorage.setItem('currentUserId', currentUserId);

            // Set queue configuration
            localStorage.setItem('queueConfiguration', JSON.stringify(DEFAULT_QUEUE_CONFIG));

            // Reset dark mode
            localStorage.setItem('darkMode', 'false');

            // Set default permissions (admin access to all)
            localStorage.setItem('currentUserPermissions', JSON.stringify({ queues: ['*'] }));

            document.getElementById('successMsg').style.display = 'block';
            document.getElementById('status').innerHTML = `
                <pre>${JSON.stringify({
                    'Queues Reset': DEFAULT_QUEUE_CONFIG.length + ' queues',
                    'Auth Preserved': !!authToken,
                    'User': currentUser,
                    'Role': currentUserRole
                }, null, 2)}</pre>
            `;

            setTimeout(() => {
                if (confirm('Reset complete! Go to home.html now?')) {
                    window.location.href = 'home.html';
                }
            }, 1000);
        }

        // Auto-show status on load
        const queueConfig = localStorage.getItem('queueConfiguration');
        if (queueConfig) {
            try {
                const queues = JSON.parse(queueConfig);
                document.getElementById('status').innerHTML = `<p>Current: ${queues.length} queues configured</p>`;
            } catch(e) {
                document.getElementById('status').innerHTML = `<p style="color:red;">Current: Invalid queue configuration</p>`;
            }
        } else {
            document.getElementById('status').innerHTML = `<p style="color:red;">Current: No queue configuration found</p>`;
        }
    </script>
</body>
</html>
